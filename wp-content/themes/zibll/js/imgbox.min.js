"use strict";window.Miniimgbox=function(i){function a(a){var t=a.parents(".imgbox"),o=t.attr("id");return i.imgbox[o][0]||i.imgbox[o]}function t(i,a,t,o){i=i&&" "+i;var s=t&&' id="'+t+'"',e="";e+=b.down?f.down:"",e+=b.zoom?f.zoom:"",o&&(e+=b.play?f.play:"",e+=b.show_thumbs?f.thumbs:""),e+=f.close;var n='<div class="imgbox-an">'+e+"</div>",l='<div class="imgbox'+i+'"'+s+">"+p+n+a+"</div>";m.append(l),r(t),auto_fun()}function o(i){return i.replace(/(.*\/)(.*)(-\d+x\d+\.)(.*)/g,"$1$2.$4").replace(/\??x-oss-process(.*)/,"")}function s(i,a){$("body").addClass("imgbox-show"),w(i,a),$(i).addClass("show").removeClass("hide")}function e(){$("body").removeClass("imgbox-show");var a=$(".imgbox.show");a.addClass("hideing").removeClass("show"),setTimeout(function(){a.removeClass("hideing").addClass("hide").attr("style",""),$(".toggle-palay.is-play").removeClass("is-play"),$.each(i.imgbox,function(i,a){try{a=a[0]||a,a.zoom.out()}catch(i){}}),$(".swiper-close").css({opacity:"",transform:""})},400)}function r(i){$("#"+i).on("touchmove pointermove MSPointerMove",function(i){i.preventDefault?i.preventDefault():i.returnValue=!1}),$("#"+i).minitouch({direction:"bottom",selector:".swiper-close",depreciation:100,onStart:!1,stop:function(i,a,t,o){var s=a.find("img").css("transform").replace(/[^0-9\-,]/g,"").split(",")[0];return s&&s>1},onIng:function(i,a,t,o){var s=(200-o)/100;s=s<1&&s,a.css("opacity",s)},inEnd:function(i,a,t,o){o<=50&&a.css({opacity:""})},onEnd:function(i,a,t,o){e(),a.css({transform:"translateY("+(o+200)+"px)"})}})}function n(i){var a=i.attr("src"),t=i.attr("data-src");if(!a&&!t)return"";var s=i.attr("data-full-url")||o(t||a),e=a==s?'<img src="'+s+'" class="lazyloaded">':'<img src="'+a+'" data-src="'+s+'"  class="lazyload"><div class="swiper-lazy-preloader"></div>',r='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container"><div class="absolute img-close"></div>'+e+"</div></div></div>";return r}function l(i){var a=i.attr("data-src")||i.attr("src");if(!a)return"";var t='<img data-src="'+a+'"  class="lazyload fit-cover">',o='<div class="swiper-slide">'+t+"</div>";return o}function c(a,t,o){tbquire(["swiper"],function(){var s="."+a,e=~~(($(i).width()+800)/310),r={init:!1};r.speed=100*e,r.zoom={maxRatio:$(i).width()<768?3:2},t&&(r.autoplay={disableOnInteraction:!1},r.grabCursor=!0,r.navigation={nextEl:s+" .swiper-button-next",prevEl:s+" .swiper-button-prev"},r.keyboard={enabled:!0,onlyInViewport:!1},r.on={slideChange:function(){$(s+" .counter-con").html('<badge class="b-black counter">'+(this.realIndex+1)+"/"+this.slides.length+"</badge>")}}),o&&(r.thumbs={swiper:i.imgbox[a+"_thumbs"],autoScrollOffset:~~(e/1.6)}),i.imgbox[a]=new Swiper(s,r)})}function d(a){tbquire(["swiper"],function(){var t=".swiper-thumbsbox."+a,o={init:!1,watchSlidesVisibility:!0};o.navigation={nextEl:t+" .swiper-button-next",prevEl:t+" .swiper-button-prev"},o.slidesPerView="auto",o.freeMode=!0,o.freeModeSticky=!0,i.imgbox[a+"_thumbs"]=new Swiper(t,o)})}function g(i){var a=i.attr("data-src")||i.attr("src");if(!a)return!1;a=o(a);var t=i.parent("a");if(!t.length)return!1;var s=t.attr("box-img")||t.attr("href");return s=o(s),s&&(-1==s.indexOf(a)||-1==a.indexOf(s))}$("link#swiper").length||$("head").append('<link type="text/css" id="swiper" rel="stylesheet" href="'+_win.uri+"/css/swiper.min.css?ver="+_win.ver+'">');var m=_win.bd,p='<div class="modal-backdrop imgbox-bg"></div>',v="imgbox-id",u="imgbox-index";i.imgbox={};var b={show_thumbs:_win.imgbox_thumbs||!1,down:_win.imgbox_down||!1,play:_win.imgbox_play||!1,zoom:_win.imgbox_zoom||!1},f={thumbs:'<a href="javascript:;" class="toggle-thumbs toggle-radius mr6" title="查看更多图片"><i class="fa fa-th-large"></i></a>',close:'<a href="javascript:;" class="icon-close toggle-radius" title="关闭"><i data-svg="close" data-class="ic-close icon em12" data-viewbox="0 0 1024 1024"></i></a>',down:'<a href="javascript:;" download class="img-down toggle-radius mr6" title="下载图片"><i class="fa fa-download"></i></a>',play:'<a href="javascript:;" class="toggle-palay toggle-radius mr6" title="播放图片"><i class="fa fa-play"></i></a>',zoom:'<a href="javascript:;" class="toggle-zoom toggle-radius mr6" title="切换图片缩放"><i class="fa fa-search"></i></a>'};m.on("click",".img-close,.imgbox-bg,.imgbox-an .icon-close",function(){e()}),m.on("click",".toggle-thumbs,.hide-but",function(){$(this).parents(".group-box").toggleClass("show-thumb")}),m.on("click",".img-down",function(){var i=$(this),a=i.parents(".imgbox"),t=a.find(".swiper-slide-active img"),o=t.attr("data-src")||t.attr("src"),s=o.substring(o.lastIndexOf("/")+1)||o;i.attr("href",o).attr("download",s)}),m.on("click",".toggle-palay",function(){var i=$(this),t=a(i);i.hasClass("is-play")?t.autoplay.stop():t.autoplay.start(),i.toggleClass("is-play")}),m.on("click",".toggle-zoom",function(){var i=$(this),t=a(i);t.zoom.toggle(),i.toggleClass("is-zoom")});var w=function(i,a){var t=a.offset(),o=t.top,s=t.left,e=$(document).scrollTop(),r=a.height(),n=a.width(),l=o-e+r/2,c=s+n/2;$(i).attr("style","--imgbox-origin-top:"+l+"px;--imgbox-origin-left:"+c+"px;")},x=function(a){var o=$(a);if(o.length){var e=b.show_thumbs,r="",p="",f="swiper-imgbox-"+parseInt((Math.random()+1)*Math.pow(10,4));o.each(function(i){var a=$(this);g(a)||(a.attr({"imgbox-id":f,"imgbox-index":i}),r+=n(a),e&&(p+=l(a)))});var w='<div class="swiper-wrapper">'+r+"</div>",x='<div class="swiper-imgbox '+f+'">'+w+'<div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-left counter-con"></div></div>',h='<div class="swiper-wrapper">'+p+"</div>",y='<div class="swiper-thumbsbox '+f+'">'+h+'<div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="abs-center right-top"><i class="hide-but fa fa-angle-down em12"></i></div></div>';e&&(x+=y);var _="group-box"+(e?" thumbs-box":"");t(_,x,f,!0),e&&d(f),c(f,!0,e),m.OnlyOn("click",a,"imgbox_group_open",function(){var a=$(this).attr(v);if(a){var t=$(this).attr(u),o=i.imgbox[a];o=o[0]||o;var e=i.imgbox[a+"_thumbs"];return s("#"+a,$(this)),e&&e.init(),o.init(),o.slideToLoop(t,10),o.autoplay.stop(),!1}})}},h=function(a){if($(a).length){var e="swiper-imgbox-alone",r="#"+e;if(!$(r).length){var n='<div class="swiper-slide"><div class="swiper-close"><div class="swiper-zoom-container alone-box-container"><div class="absolute img-close"></div><img src=""><div class="swiper-lazy-preloader"></div></div></div></div>',l='<div class="swiper-wrapper">'+n+"</div>",d='<div class="swiper-imgbox '+e+'">'+l+"</div>";t("alone-box",d,e),c(e)}var p=$(r);m.OnlyOn("click",a,"imgbox_alone_open",function(){var a=$(this);if(!a.find("img").attr(v)&&!g(a)){var t=a.attr("box-img")||a.attr("href"),n=t||a.attr("src"),l=t?o(t):a.attr("data-full-url")||o(a.attr("data-src")||n),c=n==l?'<img src="'+l+'" class="lazyloaded">':'<img src="'+n+'" data-src="'+l+'" class="lazyload">',d=p.find(".alone-box-container>img");return d.attr("src")!=l&&d.prop("outerHTML",c),i.imgbox[e].init(),i.imgbox[e].update(),s(r,a),!1}})}};return{group:x,alone:h}}(window),"group"==_win.imgbox_type?(Miniimgbox.group(".wp-posts-content img:not(.no-imgbox,.avatar,.img-icon,.avatar-badge)"),Miniimgbox.group('[data-imgbox="payimg"] img')):Miniimgbox.alone(".wp-posts-content img:not(.no-imgbox,.avatar,.img-icon,.avatar-badge)"),Miniimgbox.alone(".comment-content .box-img,.alone-imgbox-img,a[data-imgbox]");